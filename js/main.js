var up5=up5||{};up5.initialData={Places:[{placeId:1,placeName:"Museum of Edinburgh",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:1,categoryId:1,name:"museum"},lat:55.951399,lng:-3.179439},{placeId:2,placeName:"Edinburgh Museum of Childhood",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:1,categoryId:1,name:"museum"},lat:55.950417,lng:-3.185566},{placeId:3,placeName:"Scottish National Gallery",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:2,categoryId:1,name:"gallery"},lat:55.950925,lng:-3.195689},{placeId:4,placeName:"People's Story Museum",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:1,categoryId:1,name:"museum"},lat:55.951499,lng:-3.179872},{placeId:5,placeName:"Scott Monument",category:{id:3,name:"Tourism"},subcategory:{id:3,categoryId:3,name:"monument"},lat:55.952386,lng:-3.193283},{placeId:6,placeName:"Edinburgh Castle",category:{id:3,name:"Tourism"},subcategory:{id:4,categoryId:3,name:"castle"},lat:55.948592,lng:-3.199927},{placeId:7,placeName:"St. Giles Cathedral",category:{id:4,name:"Cult & Religion"},subcategory:{id:5,categoryId:4,name:"cathedral"},lat:55.949469,lng:-3.190893},{placeId:8,placeName:"Motel One Edinburgh-Royal",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:6,categoryId:2,name:"hotel"},lat:55.950721,lng:-3.191493},{placeId:9,placeName:"Motel One Edinburgh-Princes",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:6,categoryId:2,name:"hotel"},lat:55.953377,lng:-3.190219},{placeId:10,placeName:"The Elephant House",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:7,categoryId:2,name:"cafe"},lat:55.947554,lng:-3.191869},{placeId:11,placeName:"Scottish National Portrait Gallery",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:2,categoryId:1,name:"gallery"},lat:55.955506,lng:-3.193737},{placeId:12,placeName:"Scottish National Gallery of Modern Art Two",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:2,categoryId:1,name:"gallery"},lat:55.951801,lng:-3.224249},{placeId:13,placeName:"Scottish National Gallery of Modern Art One",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:2,categoryId:1,name:"gallery"},lat:55.950822,lng:-3.227704},{placeId:14,placeName:"Greyfriars Kirkyard",category:{id:4,name:"Cult & Religion"},subcategory:{id:8,categoryId:4,name:"cemetary"},lat:55.94714,lng:-3.192837},{placeId:15,placeName:"National Museum of Scotland",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:1,categoryId:1,name:"museum"},lat:55.946966,lng:-3.190874},{placeId:16,placeName:"Nelson Monument",category:{id:3,name:"Tourism"},subcategory:{id:3,categoryId:3,name:"monument"},lat:55.954417,lng:-3.182654},{placeId:17,placeName:"Old Calton Burial Ground",category:{id:4,name:"Cult & Religion"},subcategory:{id:8,categoryId:4,name:"cemetary"},lat:55.953543,lng:-3.185969},{placeId:18,placeName:"Arthur's Seat",category:{id:3,name:"Tourism"},subcategory:{id:9,categoryId:3,name:"panoramic view"},lat:55.944079,lng:-3.161835},{placeId:19,placeName:"Edinburgh Zoo",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:10,categoryId:1,name:"zoo"},lat:55.94334,lng:-3.269866},{placeId:20,placeName:"Viva Mexico",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:11,categoryId:2,name:"restaurant"},lat:55.950694,lng:-3.189544},{placeId:21,placeName:"Maxies",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:11,categoryId:2,name:"restaurant"},lat:55.948612,lng:-3.194487},{placeId:22,placeName:"Malt Shovel Inn",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:11,categoryId:2,name:"restaurant"},lat:55.950659,lng:-3.190683},{placeId:23,placeName:"Maggie Dicksons",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:11,categoryId:2,name:"restaurant"},lat:55.947957,lng:-3.195035},{placeId:24,placeName:"Wellington Coffee",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:7,categoryId:2,name:"cafe"},lat:55.953662,lng:-3.197588},{placeId:25,placeName:"Has Beans",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:7,categoryId:2,name:"cafe"},lat:55.950849,lng:-3.183124},{placeId:26,placeName:"Frankenstein",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:12,categoryId:2,name:"bar"},lat:55.947383,lng:-3.191781},{placeId:27,placeName:"Dropkick Murphys Edinburgh",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:12,categoryId:2,name:"bar"},lat:55.947889,lng:-3.191387},{placeId:28,placeName:"Premier Inn Edinburgh",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:6,categoryId:2,name:"hotel"},lat:55.951033,lng:-3.203961},{placeId:29,placeName:"The Balmoral Hotel",category:{id:2,name:"Hotels & Restaurants"},subcategory:{id:6,categoryId:2,name:"hotel"},lat:55.953124,lng:-3.189693},{placeId:30,placeName:"St. Mary's Cathedral",category:{id:4,name:"Cult & Religion"},subcategory:{id:5,categoryId:4,name:"cathedral"},lat:55.948513,lng:-3.216331},{placeId:31,placeName:"Lauriston Castle",category:{id:3,name:"Tourism"},subcategory:{id:4,categoryId:3,name:"castle"},lat:55.971157,lng:-3.278464},{placeId:32,placeName:"Edinburgh Dungeon",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:13,categoryId:1,name:"attraction"},lat:55.951117,lng:-3.190911},{placeId:33,placeName:"Our Dynamic Earth",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:13,categoryId:1,name:"attraction"},lat:55.950688,lng:-3.174751},{placeId:34,placeName:"Camera Obscura & World of Illusions",category:{id:1,name:"Culture & Entertainment"},subcategory:{id:13,categoryId:1,name:"attraction"},lat:55.948925,lng:-3.19577},{placeId:35,placeName:"Scottish Parliament Building",category:{id:3,name:"Tourism"},subcategory:{id:14,categoryId:3,name:"parliament"},lat:55.951971,lng:-3.175573}]},ko.subscribable.fn.paged=function(e){var t=this;return t.current=ko.observable(1),t.pages=ko.computed(function(){var t,a=this().length,o=Math.ceil(a/e),r=[];if(this.current()>1&&this.current()<=o)if(this.current()<o)for(t=this.current()-1;t<=this.current()+1;t++)this.current()<=o&&o>=t&&r.push(t);else for(t=this.current()-2;t<=this.current();t++)t>=1&&r.push(t);else for(t=this.current();t<=this.current()+2;t++)o>=t&&r.push(t);return r},t),t.perPage=e,t.pagedItems=ko.computed(function(){var e=this.current(),t=this.perPage*(e-1),a=t+this.perPage;return this().slice(t,a)},t),t.activePage=function(e){return this.current()===e?"active item":"item"}.bind(this),t.next=function(){this.next.enabled()&&this.current(this.current()+1)}.bind(this),t.next.enabled=ko.computed(function(){return this().length>this.perPage*this.current()},t),t.prev=function(){this.prev.enabled()&&this.current(this.current()-1)}.bind(this),t.prev.enabled=ko.computed(function(){return this.current()>1},t),t.select=function(e){this.current(e)}.bind(this),t},ko.bindingHandlers.toggle={init:function(e,t){var a=t();ko.applyBindingsToNode(e,{click:function(){a(!a())}})}},ko.bindingHandlers.toggleAndDelay={init:function(e,t){ko.bindingHandlers.checked.init(e,t),$(e).on("click",function(){$(e).prop("disabled",!0),setTimeout(function(){$(e).prop("disabled",!1)},1e3)})}},ko.utils.stringStartsWith=function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},$(function(){up5.Category=function(){this.id=ko.observable(),this.name=ko.observable()},up5.CategoryToNav=function(){var e=this;e.id=ko.observable(),e.name=ko.observable(),e.isVisible=ko.observable(),e.htmlId=ko.pureComputed(function(){return"category-"+this.id()},e),e.subcategories=ko.observableArray([]),e.isVisible.subscribe(function(){for(var t=0;t<e.subcategories().length;t++)e.subcategories()[t].isVisible(e.isVisible())})},up5.CategoryToNav.prototype=new up5.Category,up5.SubCategory=function(){this.id=ko.observable(),this.categoryId=ko.observable(),this.name=ko.observable()},up5.SubCategoryToNav=function(){var e=this;e.id=ko.observable(),e.categoryId=ko.observable(),e.name=ko.observable(),e.htmlId=ko.pureComputed(function(){return"subcategory-"+this.id()},e),e.icon=ko.pureComputed(function(){return this.name()?"images/"+this.name().replace(/\s+/g,"")+"-marker.png":""},e),e.isVisible=ko.observable()},up5.SubCategoryToNav.prototype=new up5.SubCategory,up5.Place=function(){var e=this;e.placeId=ko.observable(),e.placeName=ko.observable(),e.category=ko.observable(),e.subcategory=ko.observable(),e.lat=ko.observable(),e.lng=ko.observable(),e.markerCoords=ko.pureComputed(function(){return new google.maps.LatLng(this.lat(),this.lng())},e),e.icon=ko.pureComputed(function(){return this.subcategory()?"images/"+this.subcategory().name().replace(/\s+/g,"")+"-marker.png":""},e),e.marker=ko.pureComputed(function(){return new up5.PlacePin(up5.vm.googlemap(),this.markerCoords(),this.placeName(),this.icon()).placeId(this.placeId())},e),e.fsInfoState=ko.observable(!1),e.fsPhotosState=ko.observable(!1),e.wikiState=ko.observable(!1),e.startMsgState=ko.pureComputed(function(){var e=this.fsInfoState()+this.fsPhotosState()+this.wikiState();return!e},e),e.apiErrors=ko.observable({fsSearch:ko.observable(null),fsInfo:ko.observable(null),fsPhotos:ko.observable(null),wikiSearch:ko.observable(null),wikiQuery:ko.observable(null)}),e.fsSearchResult=ko.observable(),e.fsInfo=ko.observable(),e.fsPhotos=ko.observable(),e.fsPhotosFiltered=ko.pureComputed(function(){if("undefined"!=typeof e.fsPhotos()){for(var t=[],a=e.fsPhotos().response.photos.items,o=0;o<a.length;o++){var r=ko.observable(a[o].prefix+"300x300"+a[o].suffix);t.push(r)}return t}}),e.fsTitlePhoto=ko.computed(function(){if("undefined"!=typeof e.fsInfo()){var t=e.fsInfo().response.venue.bestPhoto;return t.prefix+"300x300"+t.suffix}return!1}),e.wiki=ko.observable(),e.fsInfoState.subscribe(function(){e.fsInfoState()&&(e.fsPhotosState(!1),e.wikiState(!1))}),e.fsPhotosState.subscribe(function(){e.fsPhotosState()&&(e.fsInfoState(!1),e.wikiState(!1))}),e.wikiState.subscribe(function(){e.wikiState()&&(e.fsInfoState(!1),e.fsPhotosState(!1))}),e.fsSearchResult.subscribe(function(){"undefined"!=typeof e.fsSearchResult()&&up5.vm.getFoursquareInfo(e)}),e.fsInfo.subscribe(function(){"undefined"!=typeof e.fsInfo()&&up5.vm.getFoursquarePhotos(e)})},up5.PlacePin=function(e,t,a,o){var r=this;r.markerObj=ko.computed(function(){var e=new google.maps.Marker({position:t,title:a,icon:new google.maps.MarkerImage(o,null,null,null,new google.maps.Size(32,37)),animation:google.maps.Animation.DROP});return e}),r.initialPos=t,r.placeId=ko.observable(),r.isVisible=ko.observable(!1),r.isVisible.subscribe(function(t){t?(r.markerObj().setAnimation(google.maps.Animation.DROP),r.markerObj().setPosition(r.initialPos),r.markerObj().setMap(e)):r.removeMarkerWithAnimation(e,r.markerObj())})},up5.PlacePin.prototype.removeMarkerWithAnimation=function(e,t){!function a(){var o=e.getProjection().fromLatLngToPoint(t.getPosition());o.y-=35/(1<<e.getZoom()),o=e.getProjection().fromPointToLatLng(o),t.setPosition(o),e.getBounds().getNorthEast().lat()<o.lat()?t.setMap(null):setTimeout(a,10)}()},up5.vm=function(){var e={pageTitle:"Project#5 @Udacity Front End Web Developer NanoDegree",personal:{author:"Vladimir Yussupov",vendorlibs:["Knockout JS","JQuery","InfoBubble","Semantic UI"]}},t=document.getElementById("map-canvas"),a={center:{lat:55.958513,lng:-3.216331},zoom:12,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.RIGHT_BOTTOM,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE]},zoomControl:!1,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]},o={apiUrl:"https://api.foursquare.com/",searchQ:"v2/venues/search",venueQ:"v2/venues/",client_id:"?client_id=RQZBTVDEWNFSFDSVVLBEEUWBTXFKPIVCH3EUBNE1UNYLEK55",client_secret:"&client_secret=ORLCOGGR1WU53EI2DC0MLRBLKNJY5PVCJKIEKN5QKPC3P3I4",version:"&v=20140806&m=foursquare"},r=ko.observable({width:ko.observable(),height:ko.observable()}),n=function(){r().width(Math.max(document.documentElement.clientWidth,window.innerWidth||0)),r().height(Math.max(document.documentElement.clientHeight,window.innerHeight||0))},i=function(){var e=function(e,t){var a=Math.pow(2,l().getZoom()),o=new google.maps.LatLng(l().getBounds().getNorthEast().lat(),l().getBounds().getSouthWest().lng()),n=l().getProjection().fromLatLngToPoint(o),i=l().getProjection().fromLatLngToPoint(l().getCenter()),s={x:Math.floor((i.x-n.x)*a),y:Math.floor((i.y-n.y)*a)},c=(r().width()-s.x)*e,u=(r().height()-s.y)*t;return{x:c,y:u}};return r().width()<r().height()?r().width()>400?e(0,-.4):r().width()>320?e(0,-.9):e(0,-.95):r().width()>640?e(0,-.75):r().width()>480?e(0,-.95):e(.2,-.95)},s=ko.computed(function(){var e={content:document.getElementById("infowindow"),shadowStyle:1,minWidth:350,maxWidth:351,minHeight:400,maxHeight:470,padding:10,hideCloseButton:!0,arrowSize:10,borderWidth:0,disableAutoPan:!0,arrowPosition:50,arrowStyle:2};return new InfoBubble(e)}),c=ko.computed(function(){var e,t,a,o,n;return r().width()<r().height()?r().width()>400?(e=350,t=351,a=400,o=470):r().width()>320?(e=350,t=351,a=410,o=411):(e=290,t=291,a=250,o=251):r().width()>640?(e=350,t=351,a=400,o=470):r().width()>480?(e=380,t=381,a=260,o=261):(e=320,t=321,a=220,o=221),n={minWidth:e,maxWidth:t,minHeight:a,maxHeight:o}}),l=(ko.computed(function(){s().setMinWidth(c().minWidth),s().setMaxWidth(c().maxWidth),s().setMinHeight(c().minHeight),s().setMaxHeight(c().maxHeight)}),ko.computed(function(){var e=new google.maps.Map(t,a);return google.maps.event.addDomListener(window,"resize",function(){var t=e.getCenter();google.maps.event.trigger(e,"resize"),e.setCenter(t),s().close(),n()}),google.maps.event.addListener(e,"click",function(){s().close(),$("#places-selection").removeClass("active visible"),$("#places-selection-mobile").removeClass("active visible"),$("#places-list").css("display","none"),$("#categories-selection").dropdown("hide"),$("#categories-selection").removeClass("active visible"),$("#accordion").css("display","none"),$("#categories-selection-mobile").removeClass("active visible")}),e})),u=ko.observableArray([]),d=ko.pureComputed(function(){for(var e={},t=0,a=u().length;a>t;t++)e[u()[t].placeId()]=u()[t];return e}),g=ko.observable(),p=ko.pureComputed(function(){var e,t,a,o,r={},n=u(),i=[],s=[];for(e=0;e<n.length;e++)t=n[e].subcategory().id(),o=n[e].subcategory().categoryId(),a=n[e].subcategory().name(),t in r||(r[t]=1,i.push((new up5.SubCategoryToNav).id(t).categoryId(o).name(a).isVisible(!0)));for(r={},e=0;e<n.length;e++){t=n[e].category().id(),a=n[e].category().name(),o=n[e].subcategory().categoryId();{n[e].subcategory().id(),n[e].subcategory().name()}t in r||(r[t]=1,s.push((new up5.CategoryToNav).id(t).name(a).isVisible(!0).subcategories([])))}for(i.sort(w),e=0;e<s.length;e++)for(var c=0;c<i.length;c++)s[e].id()===i[c].categoryId()&&s[e].subcategories().push(i[c]);return s.sort(w)}),m=ko.pureComputed(function(){for(var e=[],t=0;t<p().length;t++)for(var a=0;a<p()[t].subcategories().length;a++)p()[t].subcategories()[a].isVisible()&&e.push(p()[t].subcategories()[a].id());return ko.utils.arrayFilter(u(),function(t){return e.indexOf(t.subcategory().id())>-1}).sort(I)}),h=function(e,t,a){var o=l().getProjection().fromLatLngToPoint(e instanceof google.maps.LatLng?e:l().getCenter()),r=new google.maps.Point(("number"==typeof t?t:0)/Math.pow(2,l().getZoom())||0,("number"==typeof a?a:0)/Math.pow(2,l().getZoom())||0);l().setCenter(l().getProjection().fromPointToLatLng(new google.maps.Point(o.x-r.x,o.y+r.y)))},f=ko.pureComputed(function(){for(var e=[],t=0;t<u().length;t++)e.push(u()[t].marker());for(var a=function(e){google.maps.event.clearListeners(e.markerObj(),"click"),google.maps.event.addListener(e.markerObj(),"click",function(){s().open(l(),e.markerObj()),v(d()[e.placeId()]),l().panTo(e.markerObj().getPosition()),h(e.markerObj().getPosition(),i().x,i().y)})},o=0;o<e.length;o++)a(e[o]);return e}),y=ko.observable(""),b=ko.computed(function(){var e=y().toLowerCase();return e?ko.utils.arrayFilter(m(),function(t){return ko.utils.stringStartsWith(t.placeName().toLowerCase(),e)||t.placeName().toLowerCase().indexOf(e)>-1}):m()}).paged(5),v=function(e){g(e),S(e),T(e)},k=function(e){s().open(l(),e.marker().markerObj()),v(e),l().panTo(e.marker().markerObj().getPosition()),h(e.marker().markerObj().getPosition(),i().x,i().y),$("#places-selection").removeClass("active visible"),$("#places-selection-mobile").removeClass("active visible"),$("#places-list").css("display","none")},I=function(e,t){return e.placeName().toLowerCase()<t.placeName().toLowerCase()?-1:e.placeName().toLowerCase()>t.placeName().toLowerCase()?1:0},w=function(e,t){return e.name().toLowerCase()<t.name().toLowerCase()?-1:e.name().toLowerCase()>t.name().toLowerCase()?1:0},C=function(){var e=[];$.each(up5.initialData.Places,function(t,a){e.push((new up5.Place).placeId(a.placeId).placeName(a.placeName).category((new up5.Category).id(a.category.id).name(a.category.name)).subcategory((new up5.SubCategory).id(a.subcategory.id).categoryId(a.category.id).name(a.subcategory.name)).lat(a.lat).lng(a.lng))}),u(e),e=void 0},P=function(){for(var e=ko.utils.arrayMap(m(),function(e){return e.placeId()}),t=function(e,t,a){setTimeout(function(){e(t)},a)},a=0;a<f().length;a++)e.indexOf(f()[a].placeId())>-1?t(f()[a].isVisible,!0,20*a):t(f()[a].isVisible,!1,20*a)},S=function(e){var t=o.apiUrl+o.searchQ+o.client_id+o.client_secret+"&ll="+e.lat()+","+e.lng()+"&query="+e.placeName()+"&limit=2&radius=1000"+o.version,a=u()[u().indexOf(e)];if(a.fsSearchResult()&&200===a.fsSearchResult().meta.code){var r=(Date.now()-a.fsSearchResult().receiveTime)/1e3;r>600&&$.ajax({dataType:"json",url:t,processData:!1,success:function(t){t.receiveTime=Date.now(),u()[u().indexOf(e)].fsSearchResult(t),u()[u().indexOf(e)].apiErrors().fsSearch(null)},timeout:5e3}).fail(function(t,a){u()[u().indexOf(e)].apiErrors().fsSearch("timeout"==a?"Request timeout: Failed to search through Foursquare venues, please check your network connection and retry search later.":"Request error: Failed to search through Foursquare venues, please check your network connection and retry search later.")})}else $.ajax({dataType:"json",url:t,processData:!1,success:function(t){t.receiveTime=Date.now(),u()[u().indexOf(e)].fsSearchResult(t),u()[u().indexOf(e)].apiErrors().fsSearch(null)},timeout:5e3}).fail(function(t,a){u()[u().indexOf(e)].apiErrors().fsSearch("timeout"==a?"Request timeout: Failed to search through Foursquare venues, please check your network connection and retry search later.":"Request error: Failed to search through Foursquare venues, please check your network connection and retry search later.")})},N=function(e){var t=u()[u().indexOf(e)].fsSearchResult().response.venues;if(t.length){var a=o.apiUrl+o.venueQ+t[0].id+o.client_id+o.client_secret+o.version;$.ajax({dataType:"json",url:a,processData:!1,success:function(t){t.receiveTime=Date.now(),u()[u().indexOf(e)].fsInfo(t),u()[u().indexOf(e)].apiErrors().fsInfo(null)},timeout:5e3}).fail(function(t,a){u()[u().indexOf(e)].apiErrors().fsInfo("timeout"==a?"Request timeout: Failed to search suggested venue information, please check your network connection and retry search later.":"Request error: Failed to search suggested venue information, please check your network connection and retry search later.")})}},x=function(e){var t=u()[u().indexOf(e)].fsInfo().response.venue;if(t){var a=o.apiUrl+o.venueQ+t.id+"/photos"+o.client_id+o.client_secret+"&group=venue&limit=16"+o.version;$.ajax({dataType:"json",url:a,processData:!1,success:function(t){t.receiveTime=Date.now(),u()[u().indexOf(e)].fsPhotos(t),u()[u().indexOf(e)].apiErrors().fsPhotos(null)},timeout:5e3}).fail(function(t,a){u()[u().indexOf(e)].apiErrors().fsPhotos("timeout"==a?"Request timeout: Failed to search suggested venue's photos, please check your network connection and retry search later.":"Request error: Failed to search suggested venue's photos, please check your network connection and retry search later.")})}},T=function(e){var t=e.placeName().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),a=encodeURIComponent(t),o="https://en.wikipedia.org/w/api.php?action=query&list=search&format=json&srsearch="+a+"&srprop=timestamp%7Ctitlesnippet&continue=&callback=?",r=[],n=[];$.ajax({dataType:"json",url:o,processData:!1,success:function(a){r=a.query.search,u()[u().indexOf(e)].apiErrors().wikiSearch(null);for(var o,i=0,s="",c=0;c<r.length;c++){n.push({url:"http://en.wikipedia.org/wiki/"+encodeURIComponent(r[c].title),title:r[c].title});var l=(r[c].titlesnippet.match(/searchmatch/g)||[]).length;l>i&&(i=l,s=r[c].title,o=r[c].timestamp),r[c].matchCount=l}var d="https://en.wikipedia.org/w/api.php?format=json&action=query&titles="+encodeURIComponent(s)+"&prop=extracts&exintro&explaintext&callback=?";$.ajax({dataType:"json",url:d,processData:!1,success:function(a){u()[u().indexOf(e)].apiErrors().wikiQuery(null);var r={};if(r.receiveTime=Date.now(),a.query)for(var i in a.query.pages){r.page=a.query.pages[i],r.page.pageUrl="http://en.wikipedia.org/?curid="+r.page.pageid,r.page.lastModified=o.replace("T",", ").replace("Z","");break}else r.page={extract:'No matching results with title: "'+t+'"'};r.suggestedLinks=n,r.page.shortDesc=r.page.extract.substr(0,375)+"...",u()[u().indexOf(e)].wiki(r)},timeout:5e3}).fail(function(t,a){u()[u().indexOf(e)].apiErrors().wikiQuery("timeout"==a?"Request timeout: Failed to query suggested place description from Wikipedia, please check your network connection and retry search later.":"Request error: Failed to query suggested place description from Wikipedia, please check your network connection and retry search later.")})},timeout:5e3}).fail(function(t,a){u()[u().indexOf(e)].apiErrors().wikiSearch("timeout"==a?"Request timeout: Failed to search suggested places list at Wikipedia, please check your network connection and retry search later.":"Request error: Failed to search suggested places list at Wikipedia, please check your network connection and retry search later.")})},O=function(){$("#categories-selection").click(function(){$("#places-selection").removeClass("active visible"),$("#places-list").css("display","none")}),$("#categories-selection").dropdown({action:"nothing",allowCategorySelection:!0,fullTextSearch:!0}),$("#places-selection").click(function(){$("#categories-selection").dropdown("hide"),$("#categories-selection").removeClass("active visible"),$("#places-list").css("display",function(){return"none"===$(this).css("display")?"block":"none"}),$("#places-selection").toggleClass("active"),$("#places-filter").val(""),up5.vm.filter("")}),$("#categories-selection-mobile").click(function(){$("#places-selection-mobile").removeClass("active visible"),$("#places-list").css("display","none"),$("#accordion").css("display",function(){return"none"===$(this).css("display")?"inline-block":"none"}),$("#categories-selection-mobile").toggleClass("active")}),$("#places-selection-mobile").click(function(){$("#accordion").css("display","none"),$("#categories-selection-mobile").removeClass("active visible"),$("#places-list").css("display",function(){return"none"===$(this).css("display")?"block":"none"}),$("#places-selection-mobile").toggleClass("active"),$("#places-filter").val(""),up5.vm.filter("")}),$("#accordion").accordion({exclusive:!1,animateChildren:!1,duration:200,selector:{trigger:".title .icon"}}),$("#infowindow").css("display","block")};return{metadata:e,viewport:r,calculateViewPort:n,infowindowSize:c,infowindowOffset:i,googlemap:l,infowindow:s,places:u,placeLookupObj:d,selectedPlace:g,selectPlace:v,selectPlaceFromUI:k,loadPlaces:C,categories:p,placesToShow:m,markers:f,filter:y,filteredItems:b,applyVisibility:P,searchFoursquare:S,getFoursquareInfo:N,getFoursquarePhotos:x,getWikiDescription:T,initUI:O}}(),google.maps.event.addListenerOnce(up5.vm.googlemap(),"tilesloaded",function(){up5.vm.calculateViewPort(),up5.vm.loadPlaces(),ko.applyBindings(up5.vm),up5.vm.initUI()})});